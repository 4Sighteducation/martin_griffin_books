---
// Reviews Modal Component - Option 2: Click to Open Full-Screen Modal

export interface Review {
  quote: string;
  author: string;
  source?: string;
}

export interface Props {
  reviews: Review[];
  bookTitle: string;
}

const { reviews, bookTitle } = Astro.props;
const modalId = `modal-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="reviews-modal-section my-8">
  <!-- Trigger Button -->
  <button 
    class="review-trigger inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 font-semibold text-lg transition-all hover:gap-3"
    data-modal-id={modalId}
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
    </svg>
    Read Reviews & Praise
  </button>

  <!-- Modal Overlay -->
  <div 
    id={modalId}
    class="reviews-modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
  >
    <!-- Modal Content -->
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl transform transition-all">
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-primary-700 to-primary-600 p-6 text-white">
        <div class="flex justify-between items-start">
          <div>
            <h3 class="text-3xl font-bold mb-2">{bookTitle}</h3>
            <p class="text-primary-100">Reviews & Critical Acclaim</p>
          </div>
          <button class="close-modal text-white hover:text-primary-200 transition-colors">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Reviews List (Scrollable) -->
      <div class="overflow-y-auto max-h-[calc(90vh-120px)] p-6">
        <div class="grid gap-6">
          {reviews.map((review, index) => (
            <div class="review-item opacity-0 translate-y-4 transition-all duration-500" style={`animation-delay: ${index * 100}ms`}>
              <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-l-4 border-primary-500 hover:shadow-lg transition-shadow">
                <!-- Stars -->
                <div class="flex gap-1 mb-3">
                  {[...Array(5)].map(() => (
                    <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                      <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                    </svg>
                  ))}
                </div>
                
                <!-- Review Text -->
                <blockquote class="text-gray-700 leading-relaxed mb-4 text-lg">
                  "{review.quote}"
                </blockquote>
                
                <!-- Author -->
                <div class="flex items-center gap-2 text-sm">
                  <span class="font-bold text-primary-800">— {review.author}</span>
                  {review.source && (
                    <span class="text-gray-600">• {review.source}</span>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</div>

<script define:vars={{ modalId }}>
  const modal = document.getElementById(modalId);
  const trigger = document.querySelector(`[data-modal-id="${modalId}"]`);
  const closeBtn = modal.querySelector('.close-modal');
  const reviewItems = modal.querySelectorAll('.review-item');

  // Open modal
  trigger?.addEventListener('click', () => {
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';
    
    // Animate reviews in
    setTimeout(() => {
      reviewItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.remove('opacity-0', 'translate-y-4');
          item.classList.add('opacity-100', 'translate-y-0');
        }, index * 100);
      });
    }, 100);
  });

  // Close modal
  const closeModal = () => {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = '';
    reviewItems.forEach(item => {
      item.classList.add('opacity-0', 'translate-y-4');
      item.classList.remove('opacity-100', 'translate-y-0');
    });
  };

  closeBtn?.addEventListener('click', closeModal);
  
  // Close on outside click
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });
</script>
